---
title: "Jornada Bahada Site Data Check: Flux Table"
author: "Marguerite Mauritz"
output: flexdashboard::flex_dashboard
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# load required libraries
library(flexdashboard)
library(data.table)
library(ggplot2)
library(gridExtra)
library(lubridate)
library(plotly)

# import data directly from SEL Data Archive
flux_colnames <- fread("/Volumes/SEL_Data_Archive/Research Data/Desert/Jornada/Bahada/Tower/Flux/2019/Raw_Data/ASCII/dataL1_flux_2019.csv",
                  header = TRUE, skip=1,sep=",", fill=TRUE,
                 na.strings=c(-9999,"#NAME?"))[1,]

flux <- fread("/Volumes/SEL_Data_Archive/Research Data/Desert/Jornada/Bahada/Tower/Flux/2019/Raw_Data/ASCII/dataL1_flux_2019.csv",
                  header = FALSE, skip=4, sep=",", fill=TRUE,
                 na.strings=c(-9999,"#NAME?"),
              col.names=colnames(flux_colnames))

# convert the time stamp to a posixct format
flux[,date_time := parse_date_time(TIMESTAMP, c("%Y!-%m-%d %H:%M:%S",
                                                    "%m-%d-%y %H:%M"))]

# create derivative date columns
flux[,':=' (year = year(date_time), doy = yday(date_time), date = date(date_time))]
```

Sidebar {.sidebar}
=====================================================================
###Select Date Range and variables

These graphs show most recent incoming eddy covariance and ancillary data from the tower at the Jornada Bahada Site. Data are 30min mean values.

**Note: Flux calculations are preliminary and for visualisation only!!** 

------------------------------------------------
```{r, echo=FALSE, warning=FALSE, message=FALSE}


inputPanel(
  dateRangeInput("daterange", "Date range:",
                 start = min(flux$date),
                 end   = max(flux$date),
                 min = min(flux$date),
                 max = max(flux$date))
  )

   radioButtons("variable", "Flux variables:",
                c("CO2 Flux WPL (mg/m2/sec)",
                  "CO2 mean concentration (mg/m3)" = "CO2_mean",
                  "Sensible Heat WPL (W/m2)" = "Hc",
                  "Latent Heat WPL (W/m2)" = "LE_wpl",
                  "H2O mean concentration (g/m3)" = "H2O_Avg"))
                 
    radioButtons("variable", "Biomet variables:",
                c("Air temperature, hmp (C)" = "t_hmp_mean",
                "Air temperature, sonic (C)" = "ts_mean",
                 "Air temperature, fine wire (C)" = "fw_Avg",
                 "Atmospheric pressure (kPa)" = "atm_press_mean",
                 "Precipitation (mm)" = "precip_Tot",
                 "Leaf wetness, 5m (mV)" = "lws_1_Avg",
                 "Leaf wetness, shrub (mV)" = "lws_2_Avg",
                  "PAR (umol/m2/s)" = "par_Avg",
                  "SW Radiation (W/m2)" = c("Rs_downwell_Avg","Rs_upwell_Avg"),
                  "LW Radiation (W/m2)" = c("Rl_downwell_Avg","Rl_upwell_Avg"),
                "Soil Heat Flux (W/m2)" = c("hfp01_1_Avg", "hfp01_2_Avg", "hfp01_3_Avg", "hfp01_4_Avg")))

    radioButtons("variable", "Instrument variables:",
                c("Battery (V)" = "batt_volt_Avg",
                  "AGC/signal strength (unitless)" = "agc_Avg"))
```

Plot
=========================================================================